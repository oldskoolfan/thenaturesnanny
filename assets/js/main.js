// no longer generated by coffeescript
(function() {
  const setActiveNavlink = () => {
    const sectionClass = document.querySelector('section').className;
    let active = '';

    console.log(sectionClass);

    switch (sectionClass) {
      case 'services':
      case 'policies':
      case 'pricing':
        active = 'services';
        break;
      case 'our-friends':
      case 'rememberance':
        active = 'photos';
        break;
      default:
        active = sectionClass;
        break;
    }

    // remove all active classes first
    document.querySelectorAll('nav > *').forEach(el => el.classList.remove('active'));

    // add active class
    document.getElementById(active).classList.add('active');
  };

  const sendEmail = () => {
    const firstName = document.querySelector('input[name="firstname"]').value;
    const lastName = document.querySelector('input[name="lastname"]').value;
    const from = document.querySelector('input[name="email"]').value;
    const message = document.querySelector('textarea[name="body"]').value;
    
    if (!firstName || !lastName || !from || !message) {
     alert('All fields required');
     return false;
    }
    
    const data = {
      first_name: firstName,
      last_name: lastName,
      from,
      message,
    };
    
    fetch('https://kxx3sey25cnk5uijjiip7w3a3e0mpiwj.lambda-url.us-east-2.on.aws/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    })
      .then(resp => resp.json())
      .then(json => {
        if (json.message !== 'success') {
          throw new Error();
        }
        alert('Form submitted succesfully!');
        window.location = '/contact';
      })
      .catch(() => alert('Problem submitting form :('));

    return false;
  };

  $(function() {
    setActiveNavlink();

    // event bindings
    $('#Logo').children().first().on('click', function() {
      return location.href = "/";
    });

    $('#Slideshow').slidesjs({
      width: 800,
      height: 600,
      play: {
        active: false,
        auto: true,
        effect: "fade"
      },
      pagination: {
        active: false,
        effect: "fade"
      },
      navigation: {
        active: false,
        effect: "fade"
      }
    });

    const toggleNav = function() {
      return $('html').toggleClass("m-nav-visible");
    };
    $('#m-nav-toggle').on('click', toggleNav);

    $('#email-form').on('submit', sendEmail);
  });

}).call(this);
